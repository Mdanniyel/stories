---
// src/pages/stories/[...slug].astro
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";

export async function getStaticPaths() {
  const stories = await getCollection("stories");
  return stories.map((entry) => ({
    // Flatten the slug: remove the folder path (year) if present
    params: { slug: entry.slug.split("/").pop() },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const githubUrl = `https://github.com/Mdanniyel/stories/blob/main/src/content/stories/${entry.id}`;
---

<Layout title={entry.data.title}>
  <article
    class="bg-white p-8 rounded-lg shadow-sm border border-gray-100"
    data-pagefind-body
  >
    <header class="mb-6 border-b pb-4">
      <h1
        class="text-3xl font-bold mb-2 text-indigo-900"
        data-pagefind-meta="title"
      >
        {entry.data.title}
      </h1>
      <div class="flex flex-wrap gap-4 text-sm text-gray-500">
        <a
          href={`${import.meta.env.BASE_URL}?author=${entry.data.author}`}
          on:click|stopPropagation
          class="hover:text-indigo-600 hover:underline z-10"
          data-pagefind-meta="author"
        >
          âœï¸ {entry.data.author}
        </a>
        <span data-pagefind-meta="date:{entry.data.date.toISOString()}"
          >ğŸ“… {entry.data.date.toLocaleDateString("he-IL")}</span
        >

        <a
          href={githubUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="hover:text-indigo-600 hover:underline z-10"
        >
          âœï¸ ×¢×¨×™×›×”
        </a>

        {/* Index Tags */}
        {
          entry.data.tags &&
            entry.data.tags.map((tag) => (
              <span class="hidden" data-pagefind-meta="tag">
                {tag}
              </span>
            ))
        }

        {/* Index Category */}
        {
          (
            <span class="hidden" data-pagefind-meta="category">
              {entry.data.category}
            </span>
          )
        }
      </div>
    </header>

    <div class="prose prose-lg max-w-none prose-headings:text-indigo-800">
      <Content />
    </div>
  </article>
</Layout>
